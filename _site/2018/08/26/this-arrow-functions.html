<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>this and arrow functions Â· Kinyanjui Wangonya</title> <meta name="description" content="Arrow functions were introduced in ES6 as a new syntax for writing Javascript functions. Thanks to their short syntax, they encourage the use of small functi..."> <link rel="icon" href="http://localhost:4000/assets/favicon.png"> <link rel="apple-touch-icon" href="http://localhost:4000/assets/touch-icon.png"> <link rel="stylesheet" href="http://localhost:4000/assets/core.css"> <link rel="canonical" href="http://localhost:4000/2018/08/26/this-arrow-functions.html"> <link rel="alternate" type="application/atom+xml" title="Kinyanjui Wangonya" href="http://localhost:4000/feed.xml" /> </head> <body> <aside class="logo"> <a href="http://localhost:4000/"> <img src="/assets/me.jpg" class="logo-avatar" alt="logo"> </a> <span class="logo-prompt code">Back home</span> </aside> <div id="content"> <article> <div class="center"> <h1 class="title">this and arrow functions</h1> <time class="code">August 26, 2018</time> </div> <div class="divider"></div> <p>Arrow functions were introduced in ES6 as a new syntax for writing Javascript functions. Thanks to their short syntax, they encourage the use of small functions, which make code look cleaner (and <code class="highlighter-rouge">() =&gt;</code> just looks cooler ðŸ˜„).</p> <p>As a beginner just getting to wrap my head around ES6 syntax, I began using arrow functions <strong>everywhere</strong> without really understanding how they worked. As you might expect, I ended up running into some problems, especially with the <code class="highlighter-rouge">this</code> keyword.</p> <p><code class="highlighter-rouge">this</code> can get a bit confusing sometimes as its value varies depending on the functionâ€™s execution context, and on the mode (strict or non-strict). Much has been written about the ins and outs of that so Iâ€™ll just focus on one thing:</p> <h4 id="how-this-works-in-arrow-functions">How <code class="highlighter-rouge">this</code> works in arrow functions</h4> <p>In a regular function, <code class="highlighter-rouge">this</code> refers to the object when defined as a method of an object. We can therefor do:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">brunch</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">food</span><span class="p">:</span> <span class="s1">'Dim sum'</span><span class="p">,</span>
    <span class="na">beverage</span><span class="p">:</span> <span class="s1">'Jasmine tea'</span><span class="p">,</span>
    <span class="na">order</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">`I'll have the </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">food</span><span class="p">}</span><span class="s2"> with </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">beverage</span><span class="p">}</span><span class="s2"> please.`</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Calling <code class="highlighter-rouge">brunch.order()</code> will return <code class="highlighter-rouge">"I'll have the Dim sum with Jasmine tea please."</code></p> <p>Letâ€™s edit that and use an arrow function for <code class="highlighter-rouge">order:</code>:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">brunch</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">food</span><span class="p">:</span> <span class="s1">'Dim sum'</span><span class="p">,</span>
    <span class="na">beverage</span><span class="p">:</span> <span class="s1">'Jasmine tea'</span><span class="p">,</span>
    <span class="na">order</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">`I'll have the </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">food</span><span class="p">}</span><span class="s2"> with </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">beverage</span><span class="p">}</span><span class="s2"> please.`</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>This time, calling <code class="highlighter-rouge">brunch.order()</code> returns <code class="highlighter-rouge">"I'll have the undefined with undefined please."</code> Both <code class="highlighter-rouge">this.food</code> and <code class="highlighter-rouge">this.beverage</code> return <code class="highlighter-rouge">undefined</code>.</p> <p>It worked with the normal function, so whatâ€™s going on? In the normal function, <code class="highlighter-rouge">this</code> was our <code class="highlighter-rouge">order</code> object. When using an arrow function, <code class="highlighter-rouge">this</code> is not bound to anything and it just inherits from the parent scope which in this case is the window. Adding a <code class="highlighter-rouge">console.log(this)</code> before the <code class="highlighter-rouge">return</code> in the arrow function returns a <code class="highlighter-rouge">Window</code> object, so its looking for <code class="highlighter-rouge">Window.food</code> and <code class="highlighter-rouge">Window.beverage</code> which will obviously both be <code class="highlighter-rouge">undefined</code>.</p> <p>Arrow functions are therefor not suited as object methods.</p> <p>Another common problem area would be with event handlers. Hereâ€™s an example:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// change button colour on click
<span class="nt">&lt;style&gt;</span>
<span class="nc">.on</span> <span class="p">{</span><span class="nl">background</span><span class="p">:</span> <span class="no">red</span><span class="p">;}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"click"</span><span class="nt">&gt;</span>Toggle<span class="nt">&lt;/button&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#click'</span><span class="p">);</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// button</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s1">'on'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div> <p>In the code above, <code class="highlighter-rouge">this</code> refers to the button. Clicking on the button toggles the colour as expected. Change the function to an arrow function:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// change button colour on click
<span class="nt">&lt;style&gt;</span>
<span class="nc">.on</span> <span class="p">{</span><span class="nl">background</span><span class="p">:</span> <span class="no">red</span><span class="p">;}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"click"</span><span class="nt">&gt;</span>Toggle<span class="nt">&lt;/button&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#click'</span><span class="p">);</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">// Window { ... }</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s1">'on'</span><span class="p">);</span>
<span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div> <p>and <code class="highlighter-rouge">this</code> becomes the browserâ€™s <code class="highlighter-rouge">window</code> attribute. Clicking the button will give a <code class="highlighter-rouge">TypeError</code> error. If you rely on <code class="highlighter-rouge">this</code> in an event hanlder, a regular function may be necessary.</p> <p>So, as cool and popular as arrow functions may be, its best to understand how they work, and to know when to and not to use them.</p> </article> <div class="page-navigation code"> <a class="next" href="http://localhost:4000/2018/08/27/finding-elements.html" title="NEXT: Finding an element in the array (the ES5, ES6 and ES7 way)">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="http://localhost:4000/" title="Back to Index">Index</a> </div> </div> <div class="footer"> <span class="block">&copy; 2018 Kinyanjui Wangonya</span> </div> <script> console.log('%c%s', 'color: green; background: yellow; font-size: 25px;',"Â¯\\_(ãƒ„)_/Â¯"); </script> </body> </html>
